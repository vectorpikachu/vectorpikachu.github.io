<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="VectorPikachu">
<meta name="dcterms.date" content="2025-12-18">

<title>Ocaml 学习笔记 – VectorPikachu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ebbede3f255f00f2ca408d38e0ffdffb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-13088808e5007bdc91306a6c5cb370c5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&amp;family=Noto+Sans+SC:wght@100..900&amp;family=Ysabeau+Office:ital,wght@0,1..1000;1,1..1000&amp;display=swap" rel="stylesheet">
<script>
MathJax = {
  loader: {
    load: ['[tex]/boldsymbol']
  },
  tex: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\\[','\\]']],
    processEscapes: true,
    processEnvironments: true,
    packages: {
      '[+]': ['boldsymbol']
    }
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
    <style type="text/css">
    .ps-root .ps-algorithm {
      border-top: 2px solid;
      border-bottom: 2px solid;
    }
    .pseudocode-container {
      text-align: left;
    }
    </style>
  
      <style type="text/css">
      .ps-algorithm > .ps-line {
        text-align: left;
      }
      </style>
    

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">VectorPikachu</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../course_notes.html"> 
<span class="menu-text">Course Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blogs.html"> 
<span class="menu-text">Blogs</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-basics-of-ocaml" id="toc-the-basics-of-ocaml" class="nav-link active" data-scroll-target="#the-basics-of-ocaml">The Basics of Ocaml</a>
  <ul class="collapse">
  <li><a href="#toplevel" id="toc-toplevel" class="nav-link" data-scroll-target="#toplevel">Toplevel</a></li>
  <li><a href="#storing-code-in-files" id="toc-storing-code-in-files" class="nav-link" data-scroll-target="#storing-code-in-files">Storing code in files</a></li>
  <li><a href="#dune" id="toc-dune" class="nav-link" data-scroll-target="#dune">Dune</a></li>
  <li><a href="#ocaml-里的表达式" id="toc-ocaml-里的表达式" class="nav-link" data-scroll-target="#ocaml-里的表达式">Ocaml 里的表达式</a></li>
  <li><a href="#documentation" id="toc-documentation" class="nav-link" data-scroll-target="#documentation">Documentation</a></li>
  <li><a href="#printing" id="toc-printing" class="nav-link" data-scroll-target="#printing">Printing</a></li>
  <li><a href="#debugging" id="toc-debugging" class="nav-link" data-scroll-target="#debugging">Debugging</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  <li><a href="#datas-and-types" id="toc-datas-and-types" class="nav-link" data-scroll-target="#datas-and-types">Datas and Types</a>
  <ul class="collapse">
  <li><a href="#lists" id="toc-lists" class="nav-link" data-scroll-target="#lists">Lists</a></li>
  <li><a href="#variants" id="toc-variants" class="nav-link" data-scroll-target="#variants">Variants</a></li>
  <li><a href="#unit-testing-with-ounit2" id="toc-unit-testing-with-ounit2" class="nav-link" data-scroll-target="#unit-testing-with-ounit2">Unit Testing with OUnit2</a></li>
  <li><a href="#records-and-tuples" id="toc-records-and-tuples" class="nav-link" data-scroll-target="#records-and-tuples">Records and Tuples</a></li>
  <li><a href="#type-synonyms" id="toc-type-synonyms" class="nav-link" data-scroll-target="#type-synonyms">Type Synonyms</a></li>
  <li><a href="#options" id="toc-options" class="nav-link" data-scroll-target="#options">Options</a></li>
  <li><a href="#algebraic-data-types" id="toc-algebraic-data-types" class="nav-link" data-scroll-target="#algebraic-data-types">Algebraic Data Types</a></li>
  <li><a href="#exceptions" id="toc-exceptions" class="nav-link" data-scroll-target="#exceptions">Exceptions</a></li>
  </ul></li>
  <li><a href="#higher-order-functions" id="toc-higher-order-functions" class="nav-link" data-scroll-target="#higher-order-functions">Higher-Order Functions</a></li>
  <li><a href="#modular-programming" id="toc-modular-programming" class="nav-link" data-scroll-target="#modular-programming">Modular Programming</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Ocaml 学习笔记</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>VectorPikachu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 18, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><a href="https://cs3110.github.io/textbook/cover.html">OCaml Programming: Correct + Efficient + Beautiful — OCaml Programming: Correct + Efficient + Beautiful</a></p>
<p>This book is the textbook for CS 3110 <em>Data Structures and Functional Programming</em> at <strong>Cornell University</strong>.</p>
<p>现在我的 WSL2 里的环境如下:</p>
<ul>
<li><code>opam --version</code>: <code>2.4.1</code></li>
<li><code>opam switch list</code>: <code>4.14.1</code>(<code>ocaml-base-compiler = 4.14.1</code>), <code>default</code>(<code>ocaml-base-compiler = 5.3.0</code>)</li>
</ul>
<p>使用下面的命令创建一个新的 Switch:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">opam</span> switch create cs3110-2025fa ocaml-base-compiler.5.3.0</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">eval</span> <span class="va">$(</span><span class="ex">opam</span> env<span class="va">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">opam</span> install <span class="at">-y</span> utop odoc ounit2 qcheck bisect_ppx menhir ocaml-lsp-server ocamlformat</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You should now be able to launch <strong>utop</strong>, the OCaml Universal Toplevel.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">utop</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="the-basics-of-ocaml" class="level2">
<h2 class="anchored" data-anchor-id="the-basics-of-ocaml">The Basics of Ocaml</h2>
<section id="toplevel" class="level3">
<h3 class="anchored" data-anchor-id="toplevel">Toplevel</h3>
<p>我现在安装了 utop.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/utop.png" class="img-fluid figure-img"></p>
<figcaption>utop 运行示例</figcaption>
</figure>
</div>
<p>The best workflow when using the toplevel with code stored in files is:</p>
<ul>
<li>Edit the code in the file.</li>
<li>Load the code in the toplevel with&nbsp;<code>#use</code>.</li>
<li>Interactively test the code.</li>
<li>Exit the toplevel.&nbsp;<strong>Warning:</strong>&nbsp;do not skip this step. <code>#quit;;</code></li>
</ul>
</section>
<section id="storing-code-in-files" class="level3">
<h3 class="anchored" data-anchor-id="storing-code-in-files">Storing code in files</h3>
<p>现在我们开始在文件里写一些代码: - There is no double semicolon&nbsp;<code>;;</code>&nbsp;at the end of that line of code. The double semicolon is intended for <em>interactive sessions in the toplevel</em>, so that the toplevel knows you are done entering a piece of code. There’s usually no reason to write it in a <code>.ml</code> file.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">(* hello.ml *)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> _ = <span class="dt">print_endline</span> <span class="st">"Hello world!"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> hello-world</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> hello-world</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ocamlc</span> <span class="at">-o</span> hello.byte hello.ml</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="ex">./hello.byte</span> <span class="co"># Hello world!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="dune" class="level3">
<h3 class="anchored" data-anchor-id="dune">Dune</h3>
<section id="手工创建一个-dune-project" class="level4">
<h4 class="anchored" data-anchor-id="手工创建一个-dune-project">手工创建一个 Dune Project</h4>
<ul>
<li>创建一个名为 <code>dune</code> 的文件, 里面写上:</li>
</ul>
<pre><code>(executable
 (name hello))</code></pre>
<ul>
<li>创建一个名为 <code>dune-project</code> 的文件, 里面写上: <code>(lang dune 3.4)</code></li>
<li><code>dune build hello.exe</code> 来构建</li>
<li>接下来在 <code>_build/default/hello.exe</code> 处就可以找到构建后的可执行文件</li>
<li>或者使用 <code>dune exec hello.exe</code> 来执行文件</li>
<li><code>dune clean</code> 来清理构建的文件</li>
</ul>
</section>
<section id="自动创建一个-dune-project" class="level4">
<h4 class="anchored" data-anchor-id="自动创建一个-dune-project">自动创建一个 Dune Project</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dune</span> init project calculator</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> calculator</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">code</span> .</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">dune</span> exec bin/main.exe</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/dune.png" class="img-fluid figure-img"></p>
<figcaption><code>dune init</code> 的运行示例</figcaption>
</figure>
</div>
<p>在 VSCode 里显示如下:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/project_in_code.png" class="img-fluid figure-img"></p>
<figcaption>Dune Project in VSCode</figcaption>
</figure>
</div>
<p>可以和 <code>typst watch main.typ</code> 一样, 我们也有: <code>dune build --watch</code>.</p>
</section>
</section>
<section id="ocaml-里的表达式" class="level3">
<h3 class="anchored" data-anchor-id="ocaml-里的表达式">Ocaml 里的表达式</h3>
<p>注意:</p>
<ul>
<li>ocaml 里的 <code>*</code> 只能用作<strong>整数</strong>乘法, 浮点数必须为 <code>*.</code> (这后面有个<strong>小数点</strong>.)</li>
<li><strong>字符串的 <code>^</code> 表示拼接</strong></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/expressions.png" class="img-fluid figure-img"></p>
<figcaption>Ocaml 里的表达式</figcaption>
</figure>
</div>
<p><code>if</code> 表达式, <code>let ... in ...</code> 表达式, <code>assert</code> 表达式, 函数表达式.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/if+let.png" class="img-fluid figure-img"></p>
<figcaption><code>if</code>表达式, <code>let ... in ...</code> 表达式, <code>assert</code> 表达式</figcaption>
</figure>
</div>
<p><strong>函数表达式</strong>:</p>
<ul>
<li>普通函数: <code>let f x = ...</code></li>
<li>递归函数: <code>let rec f x = ...</code></li>
<li>Mutually Recursive Function: <code>let rec f x1 ... xn = e1 and g y1 ... ym = e2</code></li>
<li>也可以把函数写成: <code>let f = fun x -&gt; ...</code></li>
</ul>
<p>OCaml 提供一个 <code>|&gt;</code> 的中缀运算符, 实现<strong>管道 (Pipelines) 操作</strong>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>square (inc <span class="dv">5</span>);;</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> |&gt; inc |&gt; square;;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/func.png" class="img-fluid figure-img"></p>
<figcaption>函数表达式和 Pipeline</figcaption>
</figure>
</div>
<section id="polymorphic-functions" class="level4">
<h4 class="anchored" data-anchor-id="polymorphic-functions">Polymorphic Functions</h4>
<p><em>identity function</em>: <code>let id x = x</code>; <code>val id : 'a -&gt; 'a = &lt;fun&gt;</code>.</p>
<ul>
<li><code>'a</code> 是一个类型变量</li>
</ul>
<p>我们可以通过: 提供参数的类型, 提供函数的类型, 提供参数之间的运算 (这样来确定参数类型), 把多态函数确定下来.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/poly-func.png" class="img-fluid figure-img"></p>
<figcaption>Polymorphic Functions</figcaption>
</figure>
</div>
</section>
<section id="labeled-and-optional-arguments" class="level4">
<h4 class="anchored" data-anchor-id="labeled-and-optional-arguments">Labeled and Optional Arguments</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> f ~name1:arg1 ~name2:arg2 = arg1 + arg2;;</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> f ~name1:name1 ~name2:name2 = name1 + name2;;</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> f ~name1 ~name2 = name1 + name2;;</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">(* 后面两种是等价的, 标签名和参数变量名一样, 这种情况可以只写标签名. *)</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> f ~name1:(arg1 : <span class="dt">int</span>) ~name2:(arg2 : <span class="dt">int</span>) = arg1 + arg2</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> f ?name:(arg1=<span class="dv">8</span>) arg2 = arg1 + arg2</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">(* ?name代表的是可选参数, 你可以直接使用 f 7, 也可以 f ~name:2 7 *)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/Labeled-and-Optional-Arguments.png" class="img-fluid figure-img"></p>
<figcaption>Labeled and Optional Arguments</figcaption>
</figure>
</div>
</section>
<section id="partial-application" class="level4">
<h4 class="anchored" data-anchor-id="partial-application">Partial Application</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add x y = x + y</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> addx x = <span class="kw">fun</span> y -&gt; x + y</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add5 = addx <span class="dv">5</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>add5 <span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>与此同时, <code>( + )</code> 也是一个函数, 我们甚至可以自己定义自己的中缀运算符: <code>let ( op ) ... = ...</code></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/func-2.png" class="img-fluid figure-img"></p>
<figcaption>Partial Application and Operators as Functions</figcaption>
</figure>
</div>
</section>
<section id="尾递归-tail-recursion" class="level4">
<h4 class="anchored" data-anchor-id="尾递归-tail-recursion">尾递归 (Tail Recursion)</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> count n =</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> n = <span class="dv">0</span> <span class="kw">then</span> <span class="dv">0</span> <span class="kw">else</span> <span class="dv">1</span> + count (n - <span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> count_aux n acc =</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> n = <span class="dv">0</span> <span class="kw">then</span> acc <span class="kw">else</span> count_aux (n - <span class="dv">1</span>) (acc + <span class="dv">1</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> count_tr n = count_aux n <span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<blockquote class="blockquote">
<p><strong>A recursive call in tail position does not need a new stack frame. It can just reuse the existing stack frame.</strong></p>
<p>A good compiler (and the OCaml compiler is good this way) can notice when a recursive call is in&nbsp;<em>tail position</em>, which is a technical way of saying “there’s no more computation to be done after it returns”.</p>
</blockquote>
<p>换言之, 返回后就不会有更多的计算了.</p>
<ul>
<li><code>count</code> 在计算完 <code>count (n - 1)</code> 之后还需要计算一次 <code>1 + ...</code>;</li>
<li>而 <code>count_aux</code> 返回后不必进行计算了.</li>
</ul>
<p><strong>The Recipe for Tail Recursion.</strong>&nbsp;In a nutshell, here’s how we made a function be tail recursive: 1. Change the function into a helper function. Add an extra argument: the accumulator, often named&nbsp;<code>acc</code>. 2. Write a new “main” version of the function that calls the helper. It passes the original base case’s return value as the initial value of the accumulator. 3. Change the helper function to return the accumulator in the base case. 4. Change the helper function’s recursive case. It now needs to do the extra work on the accumulator argument, before the recursive call. This is the only step that requires much ingenuity.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">(** </span><span class="ot">[</span>fact n<span class="ot">]</span><span class="co"> is </span><span class="ot">[</span>n<span class="ot">]</span><span class="co"> factorial. *)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> fact n =</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> n = <span class="dv">0</span> <span class="kw">then</span> <span class="dv">1</span> <span class="kw">else</span> n * fact (n - <span class="dv">1</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> fact_aux n acc =</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> n = <span class="dv">0</span> <span class="kw">then</span> acc <span class="kw">else</span> fact_aux (n - <span class="dv">1</span>) (acc * n)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> fact_tr n = fact_aux n <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>但是这实际上会遇见 integer overflow. <span class="math inline">\(\rightarrow\)</span> <code>opam install zarith</code> (Ocaml 的大整数库)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ot">#require "zarith.top";;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> zfact_aux n acc =</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> Z.equal n Z.zero <span class="kw">then</span> acc <span class="kw">else</span> zfact_aux (Z.<span class="dt">pred</span> n) (Z.mul acc n);;</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> zfact_tr n = zfact_aux n Z.one;;</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>zfact_tr (Z.of_int <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/zarith.png" class="img-fluid figure-img"></p>
<figcaption>尾递归和<code>zarith</code>库</figcaption>
</figure>
</div>
</section>
</section>
<section id="documentation" class="level3">
<h3 class="anchored" data-anchor-id="documentation">Documentation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">(** </span><span class="ot">[</span>sum lst<span class="ot">]</span><span class="co"> is the sum of the elements of </span><span class="ot">[</span>lst<span class="ot">]</span><span class="co">. *)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> sum lst = ...</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">(** Sum a list.</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="ot">@param </span><span class="co">lst The list to be summed.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="ot">@return</span><span class="co"> The sum of the list. *)</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> sum lst = ...</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="printing" class="level3">
<h3 class="anchored" data-anchor-id="printing">Printing</h3>
<ul>
<li>使用 <code>print_endline</code> 来打印, 多个打印可以使用分号的语法糖.</li>
<li>可以使用 <code>print_string</code>, <code>print_float</code>, <code>print_newline</code> 等</li>
<li>可以使用 <code>Printf.printf</code>: <code>%s</code> 代表 string, <code>%F</code> 代表 float.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/printing.png" class="img-fluid figure-img"></p>
<figcaption>Printing</figcaption>
</figure>
</div>
</section>
<section id="debugging" class="level3">
<h3 class="anchored" data-anchor-id="debugging">Debugging</h3>
<ul>
<li>使用 print</li>
<li><code>#trace</code> 很牛</li>
<li><code>ocamldebug</code></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/trace.png" class="img-fluid figure-img"></p>
<figcaption>使用<code>#trace</code>来debug</figcaption>
</figure>
</div>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<p>Write an expression that computes&nbsp;<code>4.2</code>&nbsp;raised to the seventh power.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> ( ^^ ) x y = <span class="kw">if</span> y = <span class="dv">0</span> <span class="kw">then</span> <span class="dv">1</span>. <span class="kw">else</span> x *. (( ^^ ) x (y - <span class="dv">1</span>));;</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">(* val ( ^^ ) : float -&gt; int -&gt; float = &lt;fun&gt; *)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fl">4.2</span> ^^ <span class="dv">7</span>;;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">(* - : float = 23053.9333248000075 *)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>注意: <code>x1 = x2</code> (Structural Equality) 比较内容相等 (比如两个引用, 可以物理位置不同但是内容相同); <code>x1 == x2</code>(Physical Equality) 表示必须物理上的完全一样. - <code>"hi" = "hi"</code> 为 <code>true</code>, 而 <code>"hi" == "hi"</code> 为 <code>false</code>. ### OCaml operator cheatsheet #### Built-in infix operators</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Operator</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>=</code></td>
<td>Structural equality</td>
</tr>
<tr class="even">
<td><code>&lt;&gt;</code></td>
<td><em>Structural inequality</em></td>
</tr>
<tr class="odd">
<td><code>&lt;</code></td>
<td>Less than</td>
</tr>
<tr class="even">
<td><code>&gt;</code></td>
<td>Greater than</td>
</tr>
<tr class="odd">
<td><code>&lt;=</code></td>
<td>Less than or equal</td>
</tr>
<tr class="even">
<td><code>&gt;=</code></td>
<td>Greater than or equal</td>
</tr>
<tr class="odd">
<td><code>==</code></td>
<td>Physical equality (same object)</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td>Physical inequality (not same object)</td>
</tr>
<tr class="odd">
<td><code>&amp;&amp;</code></td>
<td>Boolean and</td>
</tr>
<tr class="even">
<td><code>||</code></td>
<td>Boolean or</td>
</tr>
<tr class="odd">
<td><code>|&gt;</code></td>
<td>Reverse function application (<code>x |&gt; f</code>&nbsp;is the same as&nbsp;<code>f x</code>)</td>
</tr>
<tr class="even">
<td><code>@@</code></td>
<td>Function application (<code>f @@ x</code>&nbsp;is the same as&nbsp;<code>f x</code>)</td>
</tr>
<tr class="odd">
<td><code>**</code></td>
<td>Float exponentiation</td>
</tr>
<tr class="even">
<td><code>^</code></td>
<td>String concatenation</td>
</tr>
<tr class="odd">
<td><code>@</code></td>
<td>List concatenation</td>
</tr>
<tr class="even">
<td><code>!</code></td>
<td>Get the value of a&nbsp;<code>ref</code></td>
</tr>
<tr class="odd">
<td><code>:=</code></td>
<td>Set the value of a&nbsp;<code>ref</code></td>
</tr>
<tr class="even">
<td><code>^^</code></td>
<td>Format string concatenation</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="datas-and-types" class="level2">
<h2 class="anchored" data-anchor-id="datas-and-types">Datas and Types</h2>
<section id="lists" class="level3">
<h3 class="anchored" data-anchor-id="lists">Lists</h3>
<ul>
<li><code>[]: 'a list</code> (<strong>注意到: list 是放在类型后面的.</strong>)</li>
<li><code>e1 :: e2 :: e3 = e1 :: (e2 :: e3)</code></li>
<li><code>[e1;&nbsp;e2;&nbsp;...;&nbsp;en] = e1&nbsp;::&nbsp;e2&nbsp;::&nbsp;...&nbsp;::&nbsp;en&nbsp;::&nbsp;[]</code></li>
</ul>
<p>列表常见的语法:</p>
<ul>
<li>Pattern Matching with Lists</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> sum lst =</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">match</span> lst <span class="kw">with</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; <span class="dv">0</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; h + sum t</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> length lst =</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">match</span> lst <span class="kw">with</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; <span class="dv">0</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; <span class="dv">1</span> + length t</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> append lst1 lst2 =</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">match</span> lst1 <span class="kw">with</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; lst2</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; h :: append t lst2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="variants" class="level3">
<h3 class="anchored" data-anchor-id="variants">Variants</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> day = Sun | Mon | Tue | Wed | Thu | Fri | Sat</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> d = Tue</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="unit-testing-with-ounit2" class="level3">
<h3 class="anchored" data-anchor-id="unit-testing-with-ounit2">Unit Testing with OUnit2</h3>
<ol type="1">
<li><code>dune init project calculator</code></li>
<li><code>lib</code> 文件夹下建立一个 <code>lib.ml</code>, 写入比如一个 <code>let rec sum lst = ...</code></li>
<li><code>test</code> 的 <code>dune</code> 文件里写入:</li>
</ol>
<pre class="dune"><code>(test
&nbsp;(name test_calculator)
&nbsp;(libraries ounit2 calculator))</code></pre>
<ol start="4" type="1">
<li><code>test</code> 的 <code>test_calculator.ml</code> 文件里写入:</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">open</span> OUnit2</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">open</span> Calculator.Lib</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> tests = <span class="st">"test suite for sum"</span> &gt;::: [</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="st">"empty"</span> &gt;:: (<span class="kw">fun</span> _ -&gt; assert_equal <span class="dv">0</span> (sum []));</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="st">"singleton"</span> &gt;:: (<span class="kw">fun</span> _ -&gt; assert_equal <span class="dv">1</span> (sum [<span class="dv">1</span>]));</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>&nbsp; <span class="st">"two_elements"</span> &gt;:: (<span class="kw">fun</span> _ -&gt; assert_equal <span class="dv">3</span> (sum [<span class="dv">1</span>; <span class="dv">2</span>]));</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> _ = run_test_tt_main tests</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="5" type="1">
<li><code>dune exec test/test_calculator.exe</code></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/OUnit2.png" class="img-fluid figure-img"></p>
<figcaption>正确和错误的示例</figcaption>
</figure>
</div>
<p>这里的 <code>&gt;::</code> 和 <code>&gt;:::</code> 都是 <code>Ounit2</code> 自定义的运算符.</p>
</section>
<section id="records-and-tuples" class="level3">
<h3 class="anchored" data-anchor-id="records-and-tuples">Records and Tuples</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> ptype = TNormal | TFire | TWater</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> mon = {name : <span class="dt">string</span>; hp : <span class="dt">int</span>; ptype : ptype}</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>{name = <span class="st">"Charmander"</span>; hp = <span class="dv">39</span>; ptype = TFire}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/Records+Tuples.png" class="img-fluid figure-img"></p>
<figcaption>Records and Tuples</figcaption>
</figure>
</div>
</section>
<section id="type-synonyms" class="level3">
<h3 class="anchored" data-anchor-id="type-synonyms">Type Synonyms</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> point = <span class="dt">float</span> * <span class="dt">float</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> vector = <span class="dt">float</span> <span class="dt">list</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> matrix = <span class="dt">float</span> <span class="dt">list</span> <span class="dt">list</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="options" class="level3">
<h3 class="anchored" data-anchor-id="options">Options</h3>
<ul>
<li><code>t&nbsp;option</code>&nbsp;is a type for every type&nbsp;<code>t</code>.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> list_max lst =</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">match</span> lst <span class="kw">with</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; <span class="dt">None</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; <span class="kw">match</span> list_max t <span class="kw">with</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>              | <span class="dt">None</span> -&gt; <span class="dt">Some</span> h</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>              | <span class="dt">Some</span> m -&gt; <span class="dt">Some</span> (<span class="dt">max</span> h m);;</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">(* val list_max : 'a list -&gt; 'a option = &lt;fun&gt; *)</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>list_max [<span class="dv">1</span>; <span class="dv">2</span>; <span class="dv">3</span>; <span class="dv">4</span>; <span class="dv">10</span>; <span class="dv">0</span>];;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">(* - : int option = Some 10 *)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/options.png" class="img-fluid figure-img"></p>
<figcaption>Options</figcaption>
</figure>
</div>
</section>
<section id="algebraic-data-types" class="level3">
<h3 class="anchored" data-anchor-id="algebraic-data-types">Algebraic Data Types</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> point = <span class="dt">float</span> * <span class="dt">float</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> shape =</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  | Point <span class="kw">of</span> point</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  | Circle <span class="kw">of</span> point * <span class="dt">float</span> <span class="co">(* center and radius *)</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  | Rect <span class="kw">of</span> point * point <span class="co">(* lower-left and upper-right corners *)</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> area sh =</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">match</span> sh <span class="kw">with</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  | Point _ -&gt; <span class="fl">0.0</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  | Circle (_, r) -&gt; Float.pi *. (r ** <span class="fl">2.0</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  | Rect ((x1, y1), (x2, y2)) -&gt;</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> w = x2 -. x1 <span class="kw">in</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> h = y2 -. y1 <span class="kw">in</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>      w *. h</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> center sh =</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">match</span> sh <span class="kw">with</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  | Point p -&gt; p</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  | Circle (p, _) -&gt; p</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  | Rect ((x1, y1), (x2, y2)) -&gt; ((x2 +. x1) /. <span class="fl">2.0</span>, (y2 +. y1) /. <span class="fl">2.0</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>还可以实现 Recursive Variants:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> intlist = Nil | Cons <span class="kw">of</span> <span class="dt">int</span> * intlist</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> 'a mylist = Nil | Cons <span class="kw">of</span> 'a * 'a mylist</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> lst3 = Cons (<span class="dv">3</span>, Nil)  <span class="co">(* similar to [3] *)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> lst_hi = Cons (<span class="st">"hi"</span>, Nil)  <span class="co">(* similar to ["hi"] *)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="exceptions" class="level3">
<h3 class="anchored" data-anchor-id="exceptions">Exceptions</h3>
<pre class="ocmal"><code>exception E of t</code></pre>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./figs/exceptions.png" class="img-fluid figure-img"></p>
<figcaption>Exceptions</figcaption>
</figure>
</div>
</section>
</section>
<section id="higher-order-functions" class="level2">
<h2 class="anchored" data-anchor-id="higher-order-functions">Higher-Order Functions</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> map f = <span class="kw">function</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; []</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; f h :: map f t</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> p x = <span class="dt">print_int</span> x; <span class="dt">print_newline</span>(); x + <span class="dv">1</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> map f = <span class="kw">function</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; []</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; <span class="kw">let</span> h' = f h <span class="kw">in</span> h' :: map f t</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> lst2 = map p [<span class="dv">1</span>; <span class="dv">2</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>比较两种实现:</p>
<ul>
<li>第一种实现 evaluates to: <code>p 1 :: (p 2 :: [])</code>, 那么 <code>p 2</code> 会先被调用, 然后是 <code>p 1</code>. 打印的顺序是 <code>2</code> 然后是 <code>1</code>.</li>
<li>第二种实现 evaluates to: <code>let h' = p 1 in h' :: (let h' = p 2 in h' :: [])</code>, 那么 <code>p 1</code> 会先被调用, 然后是 <code>p 2</code>. 打印的顺序是 <code>1</code> 然后是 <code>2</code>.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> map_tr_aux f acc = <span class="kw">function</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; acc</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; map_tr_aux f (f h :: acc) t</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> map_tr f = map_tr_aux f []</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> lst = map_tr (<span class="kw">fun</span> x -&gt; x + <span class="dv">1</span>) [<span class="dv">1</span>; <span class="dv">2</span>; <span class="dv">3</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Filter and Tail Recursion:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> <span class="kw">rec</span> filter_aux p acc = <span class="kw">function</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  | [] -&gt; acc</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  | h :: t -&gt; <span class="kw">if</span> p h <span class="kw">then</span> filter_aux p (h :: acc) t <span class="kw">else</span> filter_aux p acc t</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> filter p = filter_aux p []</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> lst = filter even [<span class="dv">1</span>; <span class="dv">2</span>; <span class="dv">3</span>; <span class="dv">4</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Fold left and Fold right:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> fold_left : ('acc -&gt; 'a -&gt; 'acc) -&gt; 'acc -&gt; 'a <span class="dt">list</span> -&gt; 'acc</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>fold_left f init [b1; ...; bn] is f (... (f (f init b1) b2) ...) bn</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> fold_right : ('a -&gt; 'acc -&gt; 'acc) -&gt; 'a <span class="dt">list</span> -&gt; 'acc -&gt; 'acc</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>fold_right f [a1; ...; an] init is f a1 (f a2 (... (f an init) ...))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="modular-programming" class="level2">
<h2 class="anchored" data-anchor-id="modular-programming">Modular Programming</h2>
<p>A <em>structure</em> is simply a collection of definitions, such as:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> inc x = x + <span class="dv">1</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> primary_color = Red | Green | Blue</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">exception</span> Oops</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> MyModule = <span class="kw">struct</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> inc x = x + <span class="dv">1</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> primary_color = Red | Green | Blue</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">exception</span> Oops</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>会产生下面的结果:</p>
<pre><code>module MyModule :
  sig
    val inc : int -&gt; int
    type primary_color = Red | Green | Blue
    exception Oops
  end</code></pre>
<p>关于一个 module 的类型, 我们称之为一个 <em>module type</em> (或者 <em>signature</em>):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="kw">type</span> LIST_STACK = <span class="kw">sig</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">exception</span> Empty</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> empty : 'a <span class="dt">list</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> is_empty : 'a <span class="dt">list</span> -&gt; <span class="dt">bool</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> push : 'a -&gt; 'a <span class="dt">list</span> -&gt; 'a <span class="dt">list</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> peek : 'a <span class="dt">list</span> -&gt; 'a</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> pop : 'a <span class="dt">list</span> -&gt; 'a <span class="dt">list</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="kw">type</span> MATH = <span class="kw">sig</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">(** </span><span class="ot">[</span>fact n<span class="ot">]</span><span class="co"> is </span><span class="ot">[</span>n!<span class="ot">]</span><span class="co">. *)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> fact : <span class="dt">int</span> -&gt; <span class="dt">int</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> Math : MATH = <span class="kw">struct</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">(** </span><span class="ot">[</span>fact_aux n acc<span class="ot">]</span><span class="co"> is </span><span class="ot">[</span>n! * acc<span class="ot">]</span><span class="co">. *)</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> <span class="kw">rec</span> fact_aux n acc =</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> n = <span class="dv">0</span> <span class="kw">then</span> acc <span class="kw">else</span> fact_aux (n - <span class="dv">1</span>) (n * acc)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> fact n = fact_aux n <span class="dv">1</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">(* Math.fact_aux 就无法访问, 从而 module type 提供了一个隐藏实现细节的功能 *)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Fucntors, 把 module 作为参数传递给另一个 module:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode ocaml code-with-copy"><code class="sourceCode ocaml"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="kw">type</span> STACK = <span class="kw">sig</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">exception</span> Empty</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> 'a stack</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> empty : 'a stack</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> is_empty : 'a stack -&gt; <span class="dt">bool</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> push : 'a -&gt; 'a stack -&gt; 'a stack</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> peek : 'a stack -&gt; 'a</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> pop : 'a stack -&gt; 'a stack</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> ListStack : STACK = <span class="kw">struct</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">exception</span> Empty</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> 'a stack = 'a <span class="dt">list</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> empty = []</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> is_empty s = (s = [])</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> push x s = x :: s</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> peek s =</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">match</span> s <span class="kw">with</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    | [] -&gt; <span class="dt">raise</span> Empty</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    | h :: _ -&gt; h</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> pop s =</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">match</span> s <span class="kw">with</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    | [] -&gt; <span class="dt">raise</span> Empty</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    | _ :: t -&gt; t</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> VariantStack = <span class="kw">struct</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">type</span> 'a t = E | S <span class="kw">of</span> 'a * 'a t</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> empty = E</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> push x s = S (x, s)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> peek = <span class="kw">function</span> E -&gt; <span class="dt">raise</span> Empty | S (x, _) -&gt; x</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> pop = <span class="kw">function</span> E -&gt; <span class="dt">raise</span> Empty | S (_, s) -&gt; s</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="co">(* Functor 的用处: 为不同的实现写同样的代码 *)</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> StackTester (S : <span class="dt">Stack</span>) = <span class="kw">struct</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> tests = [</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"peek (push x empty) = x"</span> &gt;:: <span class="kw">fun</span> _ -&gt;</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>      assert_equal <span class="dv">1</span> S.(empty |&gt; push <span class="dv">1</span> |&gt; peek)</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> ListStackTester = StackTester (ListStack)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> VariantStackTester = StackTester (VariantStack)</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> all_tests = <span class="dt">List</span>.flatten [</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>  ListStackTester.tests;</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>  VariantStackTester.tests</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
    <script type="text/javascript">
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let pseudocodeOptions = {
          indentSize: el.dataset.indentSize,
          commentDelimiter: el.dataset.commentDelimiter,
          lineNumber: el.dataset.lineNumber.toLowerCase() === "true",
          lineNumberPunc: el.dataset.lineNumberPunc,
          noEnd: el.dataset.noEnd.toLowerCase() === "true",
          titlePrefix: el.dataset.captionPrefix
        };
        pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
      });
    })(document);
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
        if (captionSpan !== null) {
          let captionPrefix = el.dataset.captionPrefix + " ";
          let captionNumber = "";
          if (el.dataset.pseudocodeNumber) {
            captionNumber = el.dataset.pseudocodeNumber + " ";
            if (el.dataset.chapterLevel) {
              captionNumber = el.dataset.chapterLevel + "." + captionNumber;
            }
          }
          captionSpan.innerHTML = captionPrefix + captionNumber;
        }
      });
    })(document);
    </script>
  




</body></html>